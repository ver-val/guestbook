<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header}"></head>
<body>
<div class="wrapper">
    <div th:replace="~{fragments/header :: topbar}"></div>

    <a th:href="@{/books}" class="back-link" th:text="#{action.back}">&larr; Назад до списку</a>

    <h1 th:text="${book.title}">Book title</h1>
    <div class="card meta">
        <div><strong th:text="#{label.author}">Автор:</strong> <span th:text="${book.author}">Автор</span></div>
        <div><strong th:text="#{label.year}">Рік:</strong> <span th:text="${book.pubYear}">Рік</span></div>
        <div><strong th:text="#{label.description}">Опис:</strong> <span th:text="${book.description}">Опис</span></div>
        <!-- ID hidden on UI -->
    </div>

    <section class="comment-form card">
        <h3 th:text="#{label.addComment}">Додати коментар</h3>
        <form class="comment-form" th:action="@{|/books/${book.id}/comments|}" method="post">
            <input type="text" name="author" th:placeholder="#{placeholder.author}" maxlength="64" required placeholder="Ім'я автора">
            <textarea name="text" th:placeholder="#{placeholder.comment}" maxlength="1000" required placeholder="Ваш коментар"></textarea>
            <button type="submit" class="button primary" th:text="#{action.submit}">Надіслати</button>
        </form>
    </section>

    <div th:if="${commentSuccess}" class="flash success auto-hide" th:text="#{msg.commentAdded}">Коментар додано.</div>
    <div th:if="${commentError}" class="flash error" th:text="${commentError}">Помилка</div>

    <section class="comment-list card">
        <h2 th:text="#{label.comments}">Коментарі</h2>
        <div th:if="${#lists.isEmpty(comments)}" th:text="#{label.noComments}">Коментарів поки немає.</div>
        <div th:each="c : ${comments}" class="comment">
            <div class="comment-meta">
                <strong th:text="${c.author}">Author</strong>
                <span class="small" th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">Date</span>
            </div>
            <div th:text="${c.text}">Comment text</div>
            <form th:action="@{|/comments/${c.id}|}" method="post" style="margin-top:0.5rem;">
                <input type="hidden" name="bookId" th:value="${book.id}">
                <button type="submit" class="button danger" th:text="#{action.delete}">Видалити</button>
            </form>
        </div>
    </section>
</div>
<script>
    // auto-hide flash messages after 3 seconds
    setTimeout(() => {
        document.querySelectorAll('.flash.auto-hide').forEach(el => el.style.display = 'none');
    }, 3000);
</script>
</body>
</html>
